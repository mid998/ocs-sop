<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CephMgrIsAbsent :: OCS Standard Operating Procedures</title>
    <link rel="canonical" href="https://mid998.github.io/ocs-sop/sop/alerts/CephMgrIsAbsent.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://mid998.github.io/ocs-sop">OCS Standard Operating Procedures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="sop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OCS Standard Operating Procedures</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMdsMissingReplicas.html">CephMdsMissingReplicas</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="CephMgrIsAbsent.html">CephMgrIsAbsent</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMgrIsMissingReplicas.html">CephMgrIsMissingReplicas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDCriticallyFull.html">CephOSDCriticallyFull</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDNearFull.html">CephOSDNearFull</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OCS Standard Operating Procedures</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OCS Standard Operating Procedures</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OCS Standard Operating Procedures</a></li>
    <li><a href="CephMgrIsAbsent.html">CephMgrIsAbsent</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/michelledipalma/redhat/osd/ocs-sop/sop/modules/alerts/pages/CephMgrIsAbsent.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CephMgrIsAbsent</h1>
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"><b>Table of Contents</b></div>
<ul class="sectlevel1">
<li><a href="#_check_description">1. Check Description</a></li>
<li><a href="#_overview">2. Overview</a></li>
<li><a href="#_prerequsities">3. Prerequsities</a>
<ul class="sectlevel2">
<li><a href="#_prerequisite_1">3.1. Prerequisite 1</a></li>
<li><a href="#_prerequisite_3">3.2. Prerequisite 3</a></li>
<li><a href="#_prerequisite_4">3.3. Prerequisite 4</a></li>
</ul>
</li>
<li><a href="#_alert">4. Alert</a>
<ul class="sectlevel2">
<li><a href="#_gather_logs">4.1. Gather logs</a></li>
<li><a href="#_make_changes_to_solve_alert">4.2. Make changes to solve alert</a></li>
</ul>
</li>
<li><a href="#_troubleshooting">5. Troubleshooting</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_check_description"><a class="anchor" href="#_check_description"></a>1. Check Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Severity:</strong> Critical</p>
</div>
<div class="paragraph">
<p><strong>Potential Customer Impact:</strong> Critical</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ceph Manager has disappeared from Prometheus target discovery. This impacts health status reporting and will cause some of the information reported by <code>ceph status</code> to be missing or stale. In addition, the ceph manager is responsible for a Manager framework aimed at expanding the Ceph existing capabilities.</p>
</div>
<div class="paragraph">
<p>To resolve this alert, you will need to determine the cause of the disappearance of the Ceph Manager and restart if necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequsities"><a class="anchor" href="#_prerequsities"></a>3. Prerequsities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisite_1"><a class="anchor" href="#_prerequisite_1"></a>3.1. Prerequisite 1</h3>
<div class="listingblock">
<div class="title">Verify the alert is still active:</div>
<div class="content">
<pre>&lt;link&gt; to cluster monitoring dashboard.</pre>
</div>
</div>
<div class="paragraph">
<p>Proceed if the alert is still active.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisite_3"><a class="anchor" href="#_prerequisite_3"></a>3.2. Prerequisite 3</h3>
<div class="listingblock">
<div class="title">Setup cluster access:</div>
<div class="content">
<pre># Setup for cluster access using normal OSD team methods.
export KUBECONFIG=&lt;check with OSD team - insert here&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisite_4"><a class="anchor" href="#_prerequisite_4"></a>3.3. Prerequisite 4</h3>
<div class="listingblock">
<div class="title">Check and document ceph cluster health:</div>
<div class="content">
<pre># Capture output using normal OSD team methods.
TOOLS_POD=$(oc get pods -n openshift-storage -l app=rook-ceph-tools -o name)
oc rsh -n openshift-storage $TOOLS_POD

# From the rsh command prompt, run the following and capture the output.
ceph status
ceph osd status
ceph osd tree
ceph df
rados df
ceph versions
exit</pre>
</div>
</div>
<div class="paragraph">
<p>If the toolbox is not deployed, please follow the directions below.
The Rook-Ceph <strong>toolbox</strong> should already be installed for this OCS on OSD cluster. If it is not, we need to deploy it since it is not shipped with OCS.</p>
</div>
<div class="listingblock execute">
<div class="title">Deploy Rook-Ceph toolbox if needed:</div>
<div class="content">
<pre class="highlightjs highlight"><code>oc patch OCSInitialization ocsinit -n openshift-storage --type json --patch  '[{ "op": "replace", "path": "/spec/enableCephTools", "value": true }]'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alert"><a class="anchor" href="#_alert"></a>4. Alert</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_gather_logs"><a class="anchor" href="#_gather_logs"></a>4.1. Gather logs</h3>
<div class="paragraph">
<p>See prequistes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_make_changes_to_solve_alert"><a class="anchor" href="#_make_changes_to_solve_alert"></a>4.2. Make changes to solve alert</h3>
<div class="paragraph">
<p>Follow standard troubleshooting workflows.</p>
</div>
<div class="listingblock">
<div class="title">Get pod status:</div>
<div class="content">
<pre>oc project openshift-storage
oc get pod | grep rook-ceph-mgr</pre>
</div>
</div>
<div class="listingblock">
<div class="title">pod status: pending &#8594; Check for resource issues, pending pvcs, node assignment, kubelet problems.</div>
<div class="content">
<pre>oc get pod | grep rook-ceph-mgr
# Examine the output for a rook-ceph-mgr that is in the pending state, not running or not ready
MYPOD=&lt;pod identified as the problem pod&gt;
oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="paragraph">
<p>Look for resource limitations or pending pvcs. Otherwise, check for node assignment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pod/${MYPOD} -o wide</pre>
</div>
</div>
<div class="paragraph">
<p>If a node was assigned, check kubelet on the node.</p>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, but NOT running &#8594; Check for app or image issues.</div>
<div class="content">
<pre>oc logs pod/${MYPOD}
oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, running, but NOT ready &#8594; Check readiness probe.</div>
<div class="content">
<pre>oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="paragraph">
<p>If you are at this step, then the pod is ok. Proceed to check the service.</p>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, running, ready, no access to app &#8594; Start debug workflow for service.</div>
<div class="content">
<pre></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>5. Troubleshooting</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Issue encountered while following the sop</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Here is the solution</pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
