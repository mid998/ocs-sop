<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CephClusterErrorState :: OCS Standard Operating Procedures</title>
    <link rel="canonical" href="https://red-hat-storage.github.io/ocs-sop/sop/alerts/CephClusterErrorState.html">
    <meta name="description" content="Storage cluster is in error state for more than 10m.">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PDMKGVZNGE"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-PDMKGVZNGE')</script>
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
          <img src="../../_/img/header_logo_reverse.svg" height="40px" alt="Red Hat Data Services">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Get Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage" target="_blank">OCS Documentation</a>
            <a class="navbar-item" href="https://bugzilla.redhat.com/describecomponents.cgi?product=Red%20Hat%20OpenShift%20Container%20Storage" target="_blank">Browse Bugs</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Improve Guides</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/blob/master/CONTRIBUTING.adoc" target="_blank">Guidelines</a>
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/issues/new/choose" target="_blank">Open Issue</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Infos</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/en/blog/channel/red-hat-storage" target="_blank">Our Blog</a>
            <a class="navbar-item" href="https://www.youtube.com/channel/UCoyG8VyvB-XUxQl1mD3T3Gw" target="_blank">Youtube</a>
            <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">OCS Technology</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="sop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OCS Standard Operating Procedures</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Alerts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="basic_template.html">basic_template</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephClusterReadOnly.html">CephClusterReadOnly</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="CephClusterErrorState.html">CephClusterErrorState</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephClusterCriticallyFull.html">CephClusterCriticallyFull</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDCriticallyFull.html">CephOSDCriticallyFull</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDNearFull.html">CephOSDNearFull</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephClusterWarningState.html">CephClusterWarningState</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMdsMissingReplicas.html">CephMdsMissingReplicas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMgrIsAbsent.html">CephMgrIsAbsent</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMgrIsMissingReplicas.html">CephMgrIsMissingReplicas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMonQuorumAtRisk.html">CephMonQuorumAtRisk</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephMonVersionMismatch.html">CephMonVersionMismatch</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephNodeDown.html">CephNodeDown</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDDiskNotResponding.html">CephOSDDiskNotResponding</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDDiskUnavailable.html">CephOSDDiskUnavailable</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephOSDVersionMismatch.html">CephOSDVersionMismatch</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="CephPGRepairTakingTooLong.html">CephPGRepairTakingTooLong</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OCS Standard Operating Procedures</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OCS Standard Operating Procedures</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OCS Standard Operating Procedures</a></li>
    <li>Alerts</li>
    <li><a href="CephClusterErrorState.html">CephClusterErrorState</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/sop/modules/alerts/pages/CephClusterErrorState.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CephClusterErrorState</h1>
<div class="sect1">
<h2 id="_title_description"><a class="anchor" href="#_title_description"></a>1. {title_description}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Storage cluster is in error state for more than 10m.</p>
</div>
<div class="paragraph">
<p>Detailed Description: This alert reflects that the rook-ceph-mgr job has been in error for an unacceptable amount of time. Check for other alerts that would have triggered prior to this one and troubleshoot those alerts first.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_title_severity"><a class="anchor" href="#_title_severity"></a>2. {title_severity}</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Error</strong></p>
</div>
<div class="paragraph">
<p>In general:</p>
</div>
<div class="paragraph">
<p><strong>Check for OCS Operator Update</strong></p>
</div>
<div class="paragraph">
<p>WIP CLI does the status of the operator reflect update in progress?
<a href="https://docs.openshift.com/container-platform/4.6/operators/admin/olm-status.html" class="bare">https://docs.openshift.com/container-platform/4.6/operators/admin/olm-status.html</a></p>
</div>
<div class="paragraph">
<p>WIP UI
The cause of the missing replicas must be determined and fixed. Basic troubleshooting starting with operator status all the way to OCP health may be required.</p>
</div>
<div class="paragraph">
<p><strong>OCS Operator Subscription Health:</strong></p>
</div>
<div class="listingblock">
<div class="title">Check the ocs-operator subscription status</div>
<div class="content">
<pre>oc get sub ocs-operator -n openshift-storage  -o json | jq .status.conditions</pre>
</div>
</div>
<div class="paragraph">
<p>Like all operators, the status conditions types are:</p>
</div>
<div class="paragraph">
<p><strong>CatalogSourcesUnhealthy, InstallPlanMissing, InstallPlanPending, InstallPlanFailed</strong></p>
</div>
<div class="paragraph">
<p>The status for each type should be False. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[
  {
    "lastTransitionTime": "2021-01-26T19:21:37Z",
    "message": "all available catalogsources are healthy",
    "reason": "AllCatalogSourcesHealthy",
    "status": "False",
    "type": "CatalogSourcesUnhealthy"
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output above shows a false status for type CatalogSourcesUnHealthly, meaning the catalog sources are healthy.  WIP insert basic cluster health/resources check?</p>
</div>
<div class="paragraph">
<p><strong>OCS Operator Pod Health:</strong></p>
</div>
<div class="paragraph">
<p>Check the OCS operator pod status to see if there is an OCS operator upgrading in progress.</p>
</div>
<div class="listingblock">
<div class="title">Find and view the status of the OCS operator: WIP Is Upgrade a status or only pending?</div>
<div class="content">
<pre>% oc get pod -n openshift-storage | grep ocs-operator
% OCSOP=$(oc get pod -n openshift-storage  -o custom-columns=POD:.metadata.name --no-headers | grep ocs-operator)
% echo $OCSOP
% oc get pod/${OCSOP} -n openshift-storage
% oc describe pod/${OCSOP} -n openshift-storage</pre>
</div>
</div>
<div class="paragraph">
<p>If you determine the OCS operator is in progress, please be patient, wait 5 minutes and this alert should resolve itself.</p>
</div>
<div class="paragraph">
<p>If you have waited or see a different error status condition, please continue troubleshooting.</p>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, running, but NOT ready &#8594; Check readiness probe.</div>
<div class="content">
<pre>oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, but NOT running &#8594; Check for app or image issues.</div>
<div class="content">
<pre>oc logs pod/${MYPOD}
oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="paragraph">
<p>If you are at this step, then the pod is ok. Proceed to check the service.</p>
</div>
<div class="listingblock">
<div class="title">pod status: NOT pending, running, ready, no access to app &#8594; Start debug workflow for service.</div>
<div class="content">
<pre></pre>
</div>
</div>
<div class="listingblock">
<div class="title">pod status: pending &#8594; Check for resource issues, pending pvcs, node assignment, kubelet problems.</div>
<div class="content">
<pre>oc get pod | grep rook-ceph-mgr
# Examine the output for a rook-ceph-mgr that is in the pending state, not running or not ready
MYPOD=&lt;pod identified as the problem pod&gt;
oc describe pod/${MYPOD}</pre>
</div>
</div>
<div class="paragraph">
<p>Look for resource limitations or pending pvcs. Otherwise, check for node assignment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pod/${MYPOD} -o wide</pre>
</div>
</div>
<div class="paragraph">
<p>If a node was assigned, check kubelet on the node.</p>
</div>
<div class="listingblock">
<div class="title">Get pod status:</div>
<div class="content">
<pre>oc project openshift-storage
oc get pod | grep rook-ceph-mgr</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_title_logs"><a class="anchor" href="#_title_logs"></a>3. {title_logs}</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Document Ceph Cluster health check:</div>
<div class="content">
<pre>For OCS specific results run:
oc adm must-gather --image=registry.redhat.io/ocs4/ocs-must-gather-rhel8:v4.6</pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
      <img src="../../_/img/header_logo.svg" alt="Red Hat Data Services">
  </a>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
